<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>User List</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body>
<div th:replace="~{admin_layout :: content(~{::usersContent})}">
    <th:block th:fragment="usersContent">
        <div class="container p-4">
            <!-- Page Header -->
            <div class="d-flex justify-content-between mb-3">
                <h2>User List</h2>
                <a href="/admin/users/add" class="btn btn-primary">Thêm Mới</a>
            </div>
        </div>
    </th:block>
</div>

        <!-- Search & Entries Selection -->
        <div class="d-flex justify-content-between mb-3">
            <input type="text" id="search" class="form-control" placeholder="Search..." onkeyup="searchTable()" style="width: 300px;">
            <select id="entries" class="form-select" onchange="changeEntries()" style="width: 150px;">
                <option value="10">10 entries</option>
                <option value="20">20 entries</option>
                <option value="50">50 entries</option>
                <option value="100">100 entries</option>
                <option value="9999">All</option>
            </select>
        </div>

        <!-- User Table -->
        <table id="userTable" class="table table-bordered">
            <thead>
            <tr>
                <th>Họ Tên</th>
                <th>Email</th>
                <th>Số Điện Thoại</th>
                <th>Tài Khoản</th>
                <th>Vai Trò</th>
                <th>Trạng Thái</th>
                <th>Hành Động</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="user : ${users}">
                <td th:text="${user.fullName ?: 'None'}"></td>
                <td th:text="${user.email ?: 'None'}"></td>
                <td th:text="${user.phoneNumber ?: 'None'}"></td>
                <td th:text="${user.username ?: 'None'}"></td>
                <td>
                    <span th:each="role, iterStat : ${user.roles}" th:text="${role.name} + ${!iterStat.last ? ', ' : ''}"></span>
                </td>
                <td th:text="${user.status == 1 ? 'Hoạt động' : 'Đã khóa'}"></td>
                <td>
                    <a th:href="@{/admin/users/edit/{id}(id=${user.id})}" class="btn btn-warning">Sửa</a>
                    <a th:href="@{/admin/users/delete/{id}(id=${user.id})}" class="btn btn-danger" onclick="return confirm('Xóa người dùng này?')">Xóa</a>
                    <a th:href="@{/admin/users/detail/{id}(id=${user.id})}" class="btn btn-info">Chi Tiết</a>
                    <a th:href="@{/admin/users/toggle/{id}(id=${user.id})}" class="btn"
                       th:text="${user.status == 1 ? 'Khóa' : 'Mở Khóa'}"
                       th:classappend="${user.status == 1 ? 'btn-danger' : 'btn-success'}"></a>
                </td>
            </tr>
            </tbody>
        </table>
    </div>
</div>

<script>
    function searchTable() {
        let input = document.getElementById("search").value.toLowerCase();
        let rows = document.querySelectorAll("#userTable tbody tr");

        rows.forEach(row => {
            let text = row.innerText.toLowerCase();
            row.style.display = text.includes(input) ? "" : "none";
        });
    }

    function changeEntries() {
        let entries = parseInt(document.getElementById("entries").value);
        let rows = document.querySelectorAll("#userTable tbody tr");

        rows.forEach((row, index) => {
            row.style.display = index < entries ? "" : "none";
        });
    }

    document.addEventListener("DOMContentLoaded", changeEntries);
</script>

</body>
</html>
